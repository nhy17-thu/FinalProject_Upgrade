<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    {% load static %}
    <link href="{% static 'css/bootstrap.min.css' %}" rel="stylesheet">
    <script src="{% static 'js/jquery-3.4.1.js' %}"></script>
    <script src="{% static 'js/bootstrap.min.js'%}"></script>
    <title>Review Previous Results</title>
</head>
<body>
    <button class="btn-default"><a href="{% url 'checkRecords' 1 %}">back to records page</a></button>


    <!-- 显示Detection处理结果(AJAX) -->
    <br />
    <p id="detection">图像Detection处理中……</p>
    <img src="" alt="Image Processing..." id="detection_pic">
    <script>
    // 使用ajax实时预览上传照片
    let detectionXML = new XMLHttpRequest();
    console.log('request for results');
    detectionXML.open('GET', '{% url 'image_result' pic_id %}', true);     // 异步获取处理结果
    detectionXML.responseType = "blob";  // 要求二进制流返回以显示图片
    detectionXML.send();

    detectionXML.onreadystatechange=function () {
        if (detectionXML.readyState === 4 && detectionXML.status === 200) {
            // 从服务器以二进制流返回上传的图片结果
            document.getElementById('detection').innerText = 'Detection处理结果如下：';
            document.getElementById('detection_pic').src = URL.createObjectURL(detectionXML.response);
        }
    }
    </script>


    <!-- 显示风格迁移处理结果(AJAX) -->
    <br />
    <p id="transfer">图像Style Transfer处理中……</p>
    <img src="" alt="Image Processing..." id="transfer_pic">
    <script>
    // 使用ajax实时预览上传照片
    let transferXML = new XMLHttpRequest();
    console.log('request for results');
    transferXML.open('GET', '{% url 'image_result_transfer' pic_id %}', true);     // 异步获取处理结果
    transferXML.responseType = "blob";  // 要求二进制流返回以显示图片
    transferXML.send();

    transferXML.onreadystatechange=function () {
        if (transferXML.readyState === 4 && transferXML.status === 200) {
            // 从服务器以二进制流返回上传的图片结果
            document.getElementById('transfer').innerText = 'Style Transfer处理结果如下：';
            document.getElementById('transfer_pic').src = URL.createObjectURL(transferXML.response);
        }
    }
    </script>

    <!-- 显示ResNet-18处理结果 -->
    <br />
    <p>在CIFAR-10数据集上训练的ResNet-18给出的分类预测结果如下：</p>
    <p>{{ classification18 }}</p>
    <p>（CIFAR-10数据集共有: plane, car, bird, cat, deer, dog, frog, horse, ship, truck十类）</p>


    <!-- 显示ResNet-152处理结果 -->
    <br />
    <p>在ImageNet数据集上训练的ResNet-152给出的分类预测结果如下：</p>
    <p>{{ classification152 }}</p>
    <p>（ImageNet数据集共有1000类）</p>


    <p id="face_detect">图像人脸识别处理中……</p>
    <img src="" alt="Image Processing..." id="face_detect_pic">
    <script>
    // 使用ajax传输Transfer处理结果
    let facesXML = new XMLHttpRequest();
    console.log('request for face detection result');
    facesXML.open('GET', '{% url 'image_result_faces' pic_id %}', true);     // 异步获取处理结果
    facesXML.responseType = "blob";  // 要求二进制流返回以显示图片
    facesXML.send();

    facesXML.onreadystatechange=function () {
        if (facesXML.readyState === 4 && facesXML.status === 200) {
            // 从服务器以二进制流返回上传的图片结果
            if (facesXML.response.size) {
                document.getElementById('face_detect').innerText = '上传图像中所有正面人脸如下：';
                document.getElementById('face_detect_pic').src = URL.createObjectURL(facesXML.response);
            } else {
                document.getElementById('face_detect').innerText = '上传图像中没有检测到正面人脸。';
                document.getElementById('face_detect_pic').remove();
            }
        }
    }
    </script>


</body>
</html>